{
  "module_name": "进入游戏",
  "version": "1.0",
  "description": "处理游戏登录流程",
  "initial_event": "main_loop",
  "flags": {
    "enter_game_flag": false
  },
  "events": [
    {
      "id": "main_loop",
      "name": "主循环 - 截图",
      "description": "主要的游戏状态检查循环，首先截图",
      "timeout": 180,
      "conditions": [],
      "actions": [
        {
          "type": "screenshot"
        }
      ],
      "next_event": "check_already_in_game",
      "on_timeout": "timeout_error"
    },
    {
      "id": "check_already_in_game",
      "name": "检查是否已在游戏中",
      "description": "检查获得道具标志，确认是否已经在游戏中",
      "timeout": 5,
      "conditions": [
        {
          "type": "found",
          "element": {
            "type": "text",
            "target": "获得道具",
            "crop": {
              "x1": 0.429,
              "y1": 0.0,
              "x2": 0.567,
              "y2": 0.119
            }
          }
        }
      ],
      "actions": [
        {
          "type": "log",
          "params": {
            "message": "检测到获得道具，已经在游戏中",
            "level": "info"
          }
        },
        {
          "type": "exit",
          "params": {
            "reason": "已经在游戏中"
          }
        }
      ],
      "next_event": "check_main_page"
    },
    {
      "id": "check_main_page",
      "name": "检查是否在主页面",
      "description": "检查基地和任务按钮，确认是否在主页面",
      "timeout": 5,
      "conditions": [
        {
          "type": "found",
          "element": {
            "type": "text",
            "target": "基地",
            "crop": {
              "x1": 0.832,
              "y1": 0.628,
              "x2": 0.866,
              "y2": 0.681
            }
          }
        },
        {
          "type": "found",
          "element": {
            "type": "text",
            "target": "任务",
            "crop": {
              "x1": 0.757,
              "y1": 0.303,
              "x2": 0.797,
              "y2": 0.348
            }
          }
        }
      ],
      "actions": [
        {
          "type": "log",
          "params": {
            "message": "已进入游戏主页面",
            "level": "info"
          }
        },
        {
          "type": "exit",
          "params": {
            "reason": "成功进入游戏"
          }
        }
      ],
      "next_event": "try_start_game"
    },
    {
      "id": "try_start_game",
      "name": "尝试点击开始游戏",
      "description": "查找并点击开始游戏按钮",
      "timeout": 5,
      "conditions": [
        {
          "type": "found",
          "element": {
            "type": "text",
            "target": ["游戏", "开始"],
            "crop": {
              "x1": 0.444,
              "y1": 0.852,
              "x2": 0.544,
              "y2": 0.908
            }
          }
        }
      ],
      "actions": [
        {
          "type": "click",
          "element": {
            "type": "text",
            "target": ["游戏", "开始"],
            "crop": {
              "x1": 0.444,
              "y1": 0.852,
              "x2": 0.544,
              "y2": 0.908
            }
          }
        },
        {
          "type": "wait",
          "params": {
            "seconds": 2
          }
        },
        {
          "type": "goto",
          "params": {
            "event_id": "main_loop"
          }
        }
      ],
      "next_event": "try_click_logo"
    },
    {
      "id": "try_click_logo",
      "name": "尝试点击尘白禁区标志",
      "description": "查找并点击尘白禁区标志",
      "timeout": 5,
      "conditions": [
        {
          "type": "found",
          "element": {
            "type": "text",
            "target": ["尘白禁区", "尘白", "禁区"],
            "crop": {
              "x1": 0.423,
              "y1": 0.754,
              "x2": 0.623,
              "y2": 0.855
            }
          }
        }
      ],
      "actions": [
        {
          "type": "click",
          "element": {
            "type": "text",
            "target": ["尘白禁区", "尘白", "禁区"],
            "crop": {
              "x1": 0.423,
              "y1": 0.754,
              "x2": 0.623,
              "y2": 0.855
            }
          }
        },
        {
          "type": "wait",
          "params": {
            "seconds": 1
          }
        },
        {
          "type": "goto",
          "params": {
            "event_id": "main_loop"
          }
        }
      ],
      "next_event": "try_close_popup"
    },
    {
      "id": "try_close_popup",
      "name": "尝试关闭弹窗",
      "description": "查找并关闭X按钮弹窗",
      "timeout": 5,
      "conditions": [
        {
          "type": "found",
          "element": {
            "type": "text",
            "target": ["X", "x"],
            "crop": {
              "x1": 0.662,
              "y1": 0.081,
              "x2": 0.984,
              "y2": 0.340
            }
          }
        }
      ],
      "actions": [
        {
          "type": "click",
          "element": {
            "type": "text",
            "target": ["X", "x"],
            "crop": {
              "x1": 0.662,
              "y1": 0.081,
              "x2": 0.984,
              "y2": 0.340
            }
          }
        },
        {
          "type": "goto",
          "params": {
            "event_id": "main_loop"
          }
        }
      ],
      "next_event": "try_close_tutorial"
    },
    {
      "id": "try_close_tutorial",
      "name": "尝试关闭新手教程",
      "description": "查找并关闭新手教程",
      "timeout": 5,
      "conditions": [
        {
          "type": "found",
          "element": {
            "type": "image",
            "target": "app/resource/images/start_game/newbird_cancel.png",
            "crop": {
              "x1": 0.5,
              "y1": 0.0,
              "x2": 1.0,
              "y2": 0.5
            }
          }
        }
      ],
      "actions": [
        {
          "type": "click",
          "element": {
            "type": "image",
            "target": "app/resource/images/start_game/newbird_cancel.png",
            "crop": {
              "x1": 0.5,
              "y1": 0.0,
              "x2": 1.0,
              "y2": 0.5
            }
          }
        },
        {
          "type": "goto",
          "params": {
            "event_id": "main_loop"
          }
        }
      ],
      "next_event": "main_loop"
    },
    {
      "id": "timeout_error",
      "name": "超时错误处理",
      "description": "处理超时错误",
      "timeout": 5,
      "conditions": [],
      "actions": [
        {
          "type": "log",
          "params": {
            "message": "进入游戏超时",
            "level": "error"
          }
        },
        {
          "type": "exit",
          "params": {
            "reason": "超时"
          }
        }
      ]
    }
  ]
}
